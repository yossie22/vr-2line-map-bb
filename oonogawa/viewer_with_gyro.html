<!DOCTYPE html>
<html>
<head>
<title>VR„ÉÑ„Ç¢„Éº</title>
<meta charset="utf-8">
<meta name="viewport" content="target-densitydpi=device-dpi, width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0, user-scalable=no, minimal-ui" />
<link rel="icon" href="vr-icon.ico" type="image/x-icon">
<style> @-ms-viewport { width: device-width; } </style>
<link rel="stylesheet" href="vendor/reset.min.css">
<style>
* { margin: 0; padding: 0; box-sizing: border-box; }
html, body { width: 100%; height: 100%; overflow: hidden; }
#pano { position: absolute; top: 0; left: 0; width: 100%; height: 100%; }

#mapButton {
  position: absolute; bottom: 30px; left: 20px; width: 70px; height: 70px;
  cursor: pointer; z-index: 100; transition: opacity 2s ease, transform 0.3s ease; opacity: 0;
}
#mapButton:hover { transform: scale(1.1); opacity: 1; }
#mapButton.visible { opacity: 0.6; }

#counter {
  position: absolute; bottom: 30px; left: 110px; width: 60px; height: 60px;
  background: white; border: 3px solid #ff0000; border-radius: 50%;
  display: flex; justify-content: center; align-items: center;
  font-size: 24px; font-weight: bold; color: #0066ff; z-index: 100;
  box-shadow: 0 4px 8px rgba(0,0,0,0.3); transition: opacity 2s ease; opacity: 0;
}
#counter.visible { opacity: 0.6; }

#volumeContainer {
  position: absolute; bottom: 30px; left: 185px;
  height: 60px; display: flex; align-items: center;
  background: rgba(54, 40, 34, 0.85);
  padding: 0 20px; border-radius: 30px;
  z-index: 100; transition: opacity 2s ease; opacity: 0;
  border: 1px solid rgba(255,255,255,0.2);
  pointer-events: none;
}
#volumeContainer.visible { opacity: 0.8; pointer-events: auto; }

#volumeLabel {
  color: #FF8C00;
  font-weight: bold; font-family: sans-serif;
  margin-right: 12px; font-size: 18px;
}

#volumeSlider {
  cursor: pointer; width: 100px; height: 8px;
  accent-color: #00FF00;
}

.arrow-nav {
  position: absolute; width: 60px; height: 60px; cursor: pointer; z-index: 100;
  transition: opacity 2s ease, transform 0.3s ease; opacity: 0;
}
.arrow-nav.visible { opacity: 0.6; }
.arrow-nav:hover { transform: scale(1.15); opacity: 1; }

#arrowUp { top: 45%; right: 15%; transform: translateY(-80px); }
#arrowDown { top: 45%; right: 15%; transform: translateY(80px); }
#arrowLeft { top: 45%; right: 15%; transform: translateX(-80px); }
#arrowRight { top: 45%; right: 15%; transform: translateX(80px); }

/* ÊñáÂ≠ó„Éõ„ÉÉ„Éà„Çπ„Éù„ÉÉ„ÉàÁî®„Çπ„Çø„Ç§„É´ */
#textHotspot {
  position: absolute;
  bottom: 30px;
  left: 340px;
  max-width: 55%;
  padding: 15px 30px;
  z-index: 90;
  opacity: 0;
  transition: opacity 1.5s ease-in-out;
  pointer-events: none;
}

#textHotspot.visible {
  opacity: 1;
}

#textHotspot p {
  color: #FFFFFF;
  font-size: 20px;
  font-weight: bold;
  text-align: left;
  line-height: 1.6;
  margin: 0;
  text-shadow: 
    -2px -2px 4px #000,
    2px -2px 4px #000,
    -2px 2px 4px #000,
    2px 2px 4px #000,
    -3px 0px 4px #000,
    3px 0px 4px #000,
    0px -3px 4px #000,
    0px 3px 4px #000,
    -2px -2px 8px #000,
    2px -2px 8px #000,
    -2px 2px 8px #000,
    2px 2px 8px #000;
  font-family: 'Hiragino Kaku Gothic Pro', 'Meiryo', sans-serif;
}

@media (max-width: 768px) {
  #textHotspot {
    bottom: 30px;
    left: 185px;
    max-width: calc(100% - 200px);
    padding: 12px 20px;
  }
  #textHotspot p {
    font-size: 16px;
  }
}

/* „Ç∏„É£„Ç§„É≠Ë®±ÂèØ„Éú„Çø„É≥ */
#gyroButton {
  position: fixed;
  top: 50%;
  left: 50%;
  transform: translate(-50%, -50%);
  background: rgba(0, 0, 0, 0.85);
  color: white;
  padding: 30px 50px;
  border: 3px solid #4CAF50;
  border-radius: 15px;
  font-size: 20px;
  font-weight: bold;
  cursor: pointer;
  z-index: 10000;
  display: none;
  text-align: center;
  box-shadow: 0 8px 16px rgba(0,0,0,0.3);
}
#gyroButton:hover {
  background: rgba(0, 100, 0, 0.9);
}
</style>
</head>
<body>

<div id="pano"></div>

<!-- „Ç∏„É£„Ç§„É≠Ë®±ÂèØ„Éú„Çø„É≥ -->
<button id="gyroButton">üì± „Ç∏„É£„Ç§„É≠„Çπ„Ç≥„Éº„Éó„ÇíÊúâÂäπ„Å´„Åô„Çã</button>

<img id="mapButton" src="MapÊàª„Çä-removebg-preview.png" alt="Map" onclick="goToMap()">
<div id="counter">1</div>

<div id="volumeContainer">
  <span id="volumeLabel">VOL</span>
  <input type="range" id="volumeSlider" min="0" max="1" step="0.05" value="0.5">
</div>

<img id="arrowUp" class="arrow-nav" src="‰∏ä-removebg-preview.png" alt="ÂâçÈÄ≤">
<img id="arrowDown" class="arrow-nav" src="‰∏ã-removebg-preview.png" alt="ÂæåÈÄÄ">
<img id="arrowLeft" class="arrow-nav" src="Â∑¶-removebg-preview.png" alt="Â∑¶„Å∏">
<img id="arrowRight" class="arrow-nav" src="Âè≥-removebg-preview.png" alt="Âè≥„Å∏">

<!-- ÊñáÂ≠ó„Éõ„ÉÉ„Éà„Çπ„Éù„ÉÉ„ÉàË°®Á§∫„Ç®„É™„Ç¢ -->
<div id="textHotspot">
  <p id="textContent"></p>
</div>

<script src="vendor/screenfull.min.js"></script>
<script src="vendor/bowser.min.js"></script>
<script src="vendor/marzipano.js"></script>
<script src="data.js"></script>

<script>
(function() {
  'use strict';
  
  var SWITCH_THRESHOLD = 91;
  var Marzipano = window.Marzipano;
  var data = window.APP_DATA;
  var panoElement = document.querySelector('#pano');
  var viewer = new Marzipano.Viewer(panoElement);
  var scenes = data.scenes;
  var scenesData = {};
  var currentScene = null;
  var currentView = null;
  var currentSceneObj = null;
  
  // Gyro variables
  var gyroEnabled = false;
  var gyroButton = document.getElementById('gyroButton');
  
  // Audio variables
  var currentVolume = 0.5;
  var audioEnabled = false;
  var playedPositions = {};
  var currentAudio = null;
  
  // Text hotspot variables
  var visitedScenes = {};
  var textHotspotElement = document.getElementById('textHotspot');
  var textContentElement = document.getElementById('textContent');
  
  var urlParams = new URLSearchParams(window.location.search);
  var startSceneParam = urlParams.get('scene');
  var startSceneNum = startSceneParam ? parseInt(startSceneParam) : 1;
  
  // sceneInfo„ÇíËá™ÂãïÁîüÊàêÔºàÂæÄÂæ©ÊíÆÂΩ±ÊñπÂºèÔºö‰ΩçÁΩÆ„ÅåÈÄÜÈ†ÜÔºâ
  var sceneInfo = {};
  var ikiScenes = [];
  var kaeriScenes = [];
  
  // Ë°å„Åç„Å®Â∏∞„Çä„ÅÆ„Ç∑„Éº„É≥„ÇíÂàÜÈ°û
  scenes.forEach(function(scene) {
    var name = scene.name;
    if (name.indexOf('b') > -1 || name.indexOf('ÔΩÇ') > -1 || name.indexOf('B') > -1) {
      kaeriScenes.push(scene);
    } else {
      ikiScenes.push(scene);
    }
  });
  
  // Ë°å„Åç„ÅÆ„Ç∑„Éº„É≥ÊÉÖÂ†±„ÇíÁîüÊàê
  ikiScenes.forEach(function(scene, index) {
    var position = index + 1;
    // ÂæÄÂæ©ÊíÆÂΩ±ÊñπÂºèÔºöÈÄÜÈ†Ü„Åß„Éö„Ç¢„É™„É≥„Ç∞
    var pairIndex = ikiScenes.length - index - 1;
    var pairId = kaeriScenes[pairIndex] ? kaeriScenes[pairIndex].id : null;
    sceneInfo[scene.id] = {
      position: position,
      direction: 'iki',
      pair: pairId
    };
  });
  
  // Â∏∞„Çä„ÅÆ„Ç∑„Éº„É≥ÊÉÖÂ†±„ÇíÁîüÊàê
  kaeriScenes.forEach(function(scene, index) {
    var position = index + 1;
    // ÂæÄÂæ©ÊíÆÂΩ±ÊñπÂºèÔºöÈÄÜÈ†Ü„Åß„Éö„Ç¢„É™„É≥„Ç∞
    var pairIndex = kaeriScenes.length - index - 1;
    var pairId = ikiScenes[pairIndex] ? ikiScenes[pairIndex].id : null;
    sceneInfo[scene.id] = {
      position: position,
      direction: 'kaeri',
      pair: pairId
    };
  });
  
  var maxPosition = Math.max(ikiScenes.length, kaeriScenes.length);
  
  scenes.forEach(function(sceneData) {
    var urlPrefix = "tiles";
    var source = Marzipano.ImageUrlSource.fromString(
      urlPrefix + "/" + sceneData.id + "/{z}/{f}/{y}/{x}.jpg",
      { cubeMapPreviewUrl: urlPrefix + "/" + sceneData.id + "/preview.jpg" }
    );
    var geometry = new Marzipano.CubeGeometry(sceneData.levels);
    var limiter = Marzipano.RectilinearView.limit.traditional(sceneData.faceSize, 75*Math.PI/180, 120*Math.PI/180);
    var view = new Marzipano.RectilinearView(sceneData.initialViewParameters, limiter);
    var scene = viewer.createScene({
      source: source, geometry: geometry, view: view, pinFirstLevel: true
    });
    
    var info = sceneInfo[sceneData.id] || {position: 1, direction: 'iki', pair: null};
    
    scenesData[sceneData.id] = {
      scene: scene,
      view: view,
      data: {
        id: sceneData.id,
        position: info.position,
        direction: info.direction,
        pair: info.pair,
        infoHotspots: sceneData.infoHotspots || []
      }
    };
  });
  
  // ÊñáÂ≠ó„Éõ„ÉÉ„Éà„Çπ„Éù„ÉÉ„ÉàË°®Á§∫Èñ¢Êï∞
  function showTextHotspot(sceneId) {
    var sceneObj = scenesData[sceneId];
    if (!sceneObj) return;
    
    // Â∏∞„Çä„É©„Ç§„É≥„Åß„ÅØË°®Á§∫„Åó„Å™„ÅÑ
    if (sceneObj.data.direction !== 'iki') {
      hideTextHotspot();
      return;
    }
    
    // Êó¢„Å´Ë®™ÂïèÊ∏à„Åø„Å™„ÇâË°®Á§∫„Åó„Å™„ÅÑ
    if (visitedScenes[sceneId]) {
      hideTextHotspot();
      return;
    }
    
    // infoHotspots„Åå„ÅÇ„Çã„Åã„ÉÅ„Çß„ÉÉ„ÇØ
    var hotspots = sceneObj.data.infoHotspots;
    if (!hotspots || hotspots.length === 0) {
      hideTextHotspot();
      return;
    }
    
    // ÊúÄÂàù„ÅÆ„Éõ„ÉÉ„Éà„Çπ„Éù„ÉÉ„Éà„ÅÆ„ÉÜ„Ç≠„Çπ„Éà„ÇíË°®Á§∫
    var hotspot = hotspots[0];
    if (hotspot.text) {
      textContentElement.textContent = hotspot.text;
      setTimeout(function() {
        textHotspotElement.classList.add('visible');
      }, 500); // „Ç∑„Éº„É≥Âàá„ÇäÊõø„ÅàÂæå0.5ÁßíÂæÖ„Å£„Å¶„Åã„Çâ„Éï„Çß„Éº„Éâ„Ç§„É≥
      
      // Ë®™ÂïèÊ∏à„Åø„Å®„Åó„Å¶„Éû„Éº„ÇØ
      visitedScenes[sceneId] = true;
    }
  }
  
  // ÊñáÂ≠ó„Éõ„ÉÉ„Éà„Çπ„Éù„ÉÉ„ÉàÈùûË°®Á§∫Èñ¢Êï∞
  function hideTextHotspot() {
    textHotspotElement.classList.remove('visible');
  }
  
  function switchScene(sceneId, newYaw, newPitch) {
    var sceneObj = scenesData[sceneId];
    if (!sceneObj) {
      console.log('Scene not found:', sceneId);
      return;
    }
    
    // ÊñáÂ≠ó„ÇíÈùûË°®Á§∫
    hideTextHotspot();
    
    var targetView = sceneObj.view;
    if (typeof newYaw !== 'undefined' && typeof newPitch !== 'undefined') {
      targetView.setParameters({ yaw: newYaw, pitch: newPitch });
    }
    sceneObj.scene.switchTo({ transitionDuration: 500 });
    currentScene = sceneObj.scene;
    currentView = targetView;
    currentSceneObj = sceneObj;
    document.getElementById('counter').textContent = sceneObj.data.position;
    
    // Play audio for iki direction only
    if (sceneObj.data.direction === 'iki') {
      playPositionSound(sceneObj.data.position);
    }
    
    // ÊñáÂ≠ó„Éõ„ÉÉ„Éà„Çπ„Éù„ÉÉ„Éà„ÇíË°®Á§∫
    showTextHotspot(sceneId);
  }
  
  function normalizeAngle(angle) {
    while (angle > Math.PI) angle -= 2 * Math.PI;
    while (angle < -Math.PI) angle += 2 * Math.PI;
    return angle;
  }
  function degToRad(deg) { return deg * Math.PI / 180; }
  function radToDeg(rad) { return rad * 180 / Math.PI; }
  
  function updateArrowVisibility() {
    if (!currentView || !currentSceneObj) return;
    var params = currentView.parameters();
    var currentYawDeg = Math.abs(radToDeg(normalizeAngle(params.yaw)));
    var arrowUp = document.getElementById('arrowUp'), arrowDown = document.getElementById('arrowDown');
    var arrowLeft = document.getElementById('arrowLeft'), arrowRight = document.getElementById('arrowRight');
    
    if (currentYawDeg <= 45 || currentYawDeg > 135) {
      arrowUp.style.display = 'block'; arrowDown.style.display = 'block';
      arrowLeft.style.display = 'none'; arrowRight.style.display = 'none';
    } else {
      arrowUp.style.display = 'none'; arrowDown.style.display = 'none';
      arrowLeft.style.display = 'block'; arrowRight.style.display = 'block';
    }
  }
  
  setInterval(function() {
    if (!currentView || !currentSceneObj) return;
    var params = currentView.parameters();
    var currentYaw = normalizeAngle(params.yaw);
    updateArrowVisibility();
    if (currentYaw > degToRad(SWITCH_THRESHOLD) || currentYaw < -degToRad(SWITCH_THRESHOLD)) {
      var pairSceneId = currentSceneObj.data.pair;
      if (!pairSceneId) return;
      var newYaw = currentYaw > 0 ? currentYaw - Math.PI : currentYaw + Math.PI;
      switchScene(pairSceneId, newYaw, params.pitch);
    }
  }, 100);
  
  // Volume control
  var volumeSlider = document.getElementById('volumeSlider');
  volumeSlider.addEventListener('input', function() {
    currentVolume = this.value;
    if (currentAudio) {
      currentAudio.volume = currentVolume;
    }
  });
  
  // Audio playback function
  function playPositionSound(position) {
    if (!audioEnabled) return;
    if (playedPositions[position]) return;
    
    var soundFiles = {
      1: 'sounds/position1.mp3',
      2: 'sounds/position2.mp3',
      3: 'sounds/position3.mp3',
      4: 'sounds/position4.mp3',
      5: 'sounds/position5.mp3',
      6: 'sounds/position6.mp3',
      7: 'sounds/position7.mp3'
    };
    
    if (!soundFiles[position]) return;
    
    if (currentAudio) {
      currentAudio.pause();
      currentAudio = null;
    }
    
    var audio = new Audio(soundFiles[position]);
    audio.volume = currentVolume;
    audio.play().catch(function(e) {
      console.log('Audio play failed:', e);
    });
    currentAudio = audio;
    playedPositions[position] = true;
  }
  
  // Enable audio on first interaction
  function tryEnableAudio() {
    audioEnabled = true;
  }
  document.addEventListener('click', tryEnableAudio, { once: true });
  document.addEventListener('touchstart', tryEnableAudio, { once: true });
  
  window.goToMap = function() {
    if (currentAudio) currentAudio.pause();
    // Âú∞Âõ≥„Å´Êàª„ÇãÈöõ„Å´Ë®™ÂïèÂ±•Ê≠¥„Çí„É™„Çª„ÉÉ„Éà
    visitedScenes = {};
    playedPositions = {};
    window.location.href = 'map.html';
  };
  
  window.moveForward = function() {
    if (!currentSceneObj) return;
    var nextPos = currentSceneObj.data.direction === 'iki' ? 
      currentSceneObj.data.position + 1 : currentSceneObj.data.position + 1;
    if (nextPos < 1 || nextPos > maxPosition) return;
    
    for (var id in scenesData) {
      if (scenesData[id].data.position === nextPos && 
          scenesData[id].data.direction === currentSceneObj.data.direction) {
        switchScene(id, currentView.parameters().yaw, currentView.parameters().pitch);
        return;
      }
    }
  };
  
  window.moveBackward = function() {
    if (!currentSceneObj) return;
    var prevPos = currentSceneObj.data.direction === 'iki' ? 
      currentSceneObj.data.position - 1 : currentSceneObj.data.position - 1;
    if (prevPos < 1 || prevPos > maxPosition) return;
    
    for (var id in scenesData) {
      if (scenesData[id].data.position === prevPos && 
          scenesData[id].data.direction === currentSceneObj.data.direction) {
        switchScene(id, currentView.parameters().yaw, currentView.parameters().pitch);
        return;
      }
    }
  };
  
  window.moveLeft = function() {
    if (!currentView || !currentSceneObj) return;
    var currentYaw = normalizeAngle(currentView.parameters().yaw);
    if (currentYaw < 0) {
      moveBackward();
    } else {
      moveForward();
    }
  };
  
  window.moveRight = function() {
    if (!currentView || !currentSceneObj) return;
    var currentYaw = normalizeAngle(currentView.parameters().yaw);
    if (currentYaw > 0) {
      moveBackward();
    } else {
      moveForward();
    }
  };
  
  var uiElements = [
    document.getElementById('mapButton'),
    document.getElementById('counter'),
    document.getElementById('volumeContainer'),
    document.getElementById('arrowUp'),
    document.getElementById('arrowDown'),
    document.getElementById('arrowLeft'),
    document.getElementById('arrowRight')
  ];
  
  var hideTimer = null;
  function showUI() {
    uiElements.forEach(function(el) { if (el) el.classList.add('visible'); });
    if (hideTimer) clearTimeout(hideTimer);
    hideTimer = setTimeout(function() {
      uiElements.forEach(function(el) { if (el) el.classList.remove('visible'); });
    }, 2000);
  }
  
  document.addEventListener('mousemove', showUI);
  document.addEventListener('touchstart', showUI);
  
  // Èï∑Êäº„ÅóËá™ÂãïÁßªÂãïÊ©üËÉΩ
  var autoMoveInterval = null;
  var autoMoveDelay = 800; // 0.8Áßí„Åî„Å®„Å´ÁßªÂãï
  
  function startAutoMove(moveFunction) {
    if (autoMoveInterval) return; // Êó¢„Å´ÂÆüË°å‰∏≠„Å™„ÇâÁÑ°Ë¶ñ
    moveFunction(); // ÊúÄÂàù„ÅÆ1Âõû„ÅØ„Åô„ÅêÂÆüË°å
    autoMoveInterval = setInterval(moveFunction, autoMoveDelay);
  }
  
  function stopAutoMove() {
    if (autoMoveInterval) {
      clearInterval(autoMoveInterval);
      autoMoveInterval = null;
    }
  }
  
  // Áü¢Âç∞„Éú„Çø„É≥„ÅÆ„Ç§„Éô„É≥„ÉàË®≠ÂÆö
  var arrowUp = document.getElementById('arrowUp');
  var arrowDown = document.getElementById('arrowDown');
  var arrowLeft = document.getElementById('arrowLeft');
  var arrowRight = document.getElementById('arrowRight');
  
  // ‰∏äÁü¢Âç∞ÔºàÂâçÈÄ≤Ôºâ
  arrowUp.addEventListener('mousedown', function() { startAutoMove(moveForward); });
  arrowUp.addEventListener('mouseup', stopAutoMove);
  arrowUp.addEventListener('mouseleave', stopAutoMove);
  arrowUp.addEventListener('touchstart', function(e) { e.preventDefault(); startAutoMove(moveForward); });
  arrowUp.addEventListener('touchend', function(e) { e.preventDefault(); stopAutoMove(); });
  
  // ‰∏ãÁü¢Âç∞ÔºàÂæåÈÄÄÔºâ
  arrowDown.addEventListener('mousedown', function() { startAutoMove(moveBackward); });
  arrowDown.addEventListener('mouseup', stopAutoMove);
  arrowDown.addEventListener('mouseleave', stopAutoMove);
  arrowDown.addEventListener('touchstart', function(e) { e.preventDefault(); startAutoMove(moveBackward); });
  arrowDown.addEventListener('touchend', function(e) { e.preventDefault(); stopAutoMove(); });
  
  // Â∑¶Áü¢Âç∞
  arrowLeft.addEventListener('mousedown', function() { startAutoMove(moveLeft); });
  arrowLeft.addEventListener('mouseup', stopAutoMove);
  arrowLeft.addEventListener('mouseleave', stopAutoMove);
  arrowLeft.addEventListener('touchstart', function(e) { e.preventDefault(); startAutoMove(moveLeft); });
  arrowLeft.addEventListener('touchend', function(e) { e.preventDefault(); stopAutoMove(); });
  
  // Âè≥Áü¢Âç∞
  arrowRight.addEventListener('mousedown', function() { startAutoMove(moveRight); });
  arrowRight.addEventListener('mouseup', stopAutoMove);
  arrowRight.addEventListener('mouseleave', stopAutoMove);
  arrowRight.addEventListener('touchstart', function(e) { e.preventDefault(); startAutoMove(moveRight); });
  arrowRight.addEventListener('touchend', function(e) { e.preventDefault(); stopAutoMove(); });
  
  // „Ç∏„É£„Ç§„É≠„Çπ„Ç≥„Éº„ÉóÊ©üËÉΩ
  function enableGyro() {
    if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
      // iOS 13+ „ÅÆË®±ÂèØ„É™„ÇØ„Ç®„Çπ„Éà
      DeviceOrientationEvent.requestPermission()
        .then(function(response) {
          if (response === 'granted') {
            gyroButton.style.display = 'none';
            activateGyro();
          } else {
            alert('„Ç∏„É£„Ç§„É≠„Çπ„Ç≥„Éº„Éó„ÅÆË®±ÂèØ„ÅåÂøÖË¶Å„Åß„Åô');
          }
        })
        .catch(function(error) {
          console.error('Gyro permission error:', error);
          alert('„Ç∏„É£„Ç§„É≠„Çπ„Ç≥„Éº„Éó„ÇíÊúâÂäπ„Å´„Åß„Åç„Åæ„Åõ„Çì„Åß„Åó„Åü');
        });
    } else {
      // Android „Åæ„Åü„ÅØÂè§„ÅÑiOS
      gyroButton.style.display = 'none';
      activateGyro();
    }
  }
  
  function activateGyro() {
    gyroEnabled = true;
    viewer.controls().enableMethod('deviceOrientation');
  }
  
  // iOS/„É¢„Éê„Ç§„É´„Éá„Éê„Ç§„Çπ„Åß„Éú„Çø„É≥„ÇíË°®Á§∫
  function checkMobile() {
    var isMobile = /iPhone|iPad|iPod|Android/i.test(navigator.userAgent);
    if (isMobile) {
      gyroButton.style.display = 'block';
    }
  }
  
  gyroButton.addEventListener('click', enableGyro);
  checkMobile();
  
  // Find initial scene
  var initialSceneId = null;
  for (var id in scenesData) {
    if (scenesData[id].data.position === startSceneNum && scenesData[id].data.direction === 'iki') {
      initialSceneId = id;
      break;
    }
  }
  
  if (initialSceneId) {
    switchScene(initialSceneId);
  } else {
    switchScene('0-1');
  }
  showUI();
  
})();
</script>
</body>
</html>
